#parse("report/velocity/header.vm")
#parse("report/velocity/macros/date.macros.vm")
#parse("report/velocity/macros/site.summary.macros.vm")
#parse("report/velocity/site.summary.logic.vm")

#set ($siteElement = $document.getRootElement())
#set ($metricsElement = $siteElement.getChild("metrics"))

##  Create median  
#set ($scoreMedian = $math.roundTo($nrOfDecimals,$metricsElement.getChild("score").getChild("median").getValue()))   
#set ($jsMedian = $math.roundTo($nrOfDecimals,$metricsElement.getChild("js").getChild("median").getValue()))  
#set ($requestMedian = $math.roundTo($nrOfDecimals,$metricsElement.getChild("requests").getChild("median").getValue()))  
#set ($cssMedian = $math.roundTo($nrOfDecimals,$metricsElement.getChild("css").getChild("median").getValue()))  
#set ($cssImageMedian = $math.roundTo($nrOfDecimals,$metricsElement.getChild("cssimages").getChild("median").getValue()))  
#set ($imageMedian = $math.roundTo($nrOfDecimals,$metricsElement.getChild("images").getChild("median").getValue()))
#set ($pageWeightMedian = $math.roundTo($nrOfDecimals,$metricsElement.getChild("pageweight").getChild("median").getValue()))  
#set ($totalDocumentWeightMedian = $math.roundTo($nrOfDecimals,$metricsElement.getChild("documentweight").getChild("median").getValue()))  
#set ($totalJsSyncInHeadMedian = $math.roundTo($nrOfDecimals,$metricsElement.getChild("jssyncinhead").getChild("median").getValue()))  
#set ($totalSpofMedian = $math.roundTo($nrOfDecimals,$metricsElement.getChild("spof").getChild("median").getValue()))  
#set ($totalAssetsWithoutExpiresMedian = $math.roundTo($nrOfDecimals,$metricsElement.getChild("assetswithoutexpires").getChild("median").getValue())) 
#set ($totalCriticalPathMedian = $math.roundTo($nrOfDecimals,$metricsElement.getChild("criticalpath").getChild("median").getValue())) 
#set ($textContentMedian = $math.roundTo($nrOfDecimals,$metricsElement.getChild("textcontent").getChild("median").getValue())) 
#set ($ttfbMedian = $math.roundTo(3,$metricsElement.getChild("ttfb").getChild("median").getValue()))
#set ($frontendMedianPercentage = $math.roundTo(1,$metricsElement.getChild("frontend").getChild("median").getValue()))
#set ($backendMedianPercentage = $math.roundTo(1,$metricsElement.getChild("backend").getChild("median").getValue()))
#set ($totalDomElementsMedian = $math.roundTo(1,$metricsElement.getChild("domelements").getChild("median").getValue()))
#set ($imageWeightMedian = $math.roundTo($nrOfDecimals,$metricsElement.getChild("imageweight").getChild("median").getValue())) 
#set ($totalImageWeightMedian = $math.roundTo($nrOfDecimals,$metricsElement.getChild("totalimageweight").getChild("median").getValue())) 

## Create percentilee95
#set ($scorePercentile = $math.toInteger($metricsElement.getChild("score").getChild("percentile95").getValue()))   
#set ($jsPercentile = $math.toInteger($metricsElement.getChild("js").getChild("percentile95").getValue()))  
#set ($requestPercentile = $math.toInteger($metricsElement.getChild("requests").getChild("percentile95").getValue())) 
#set ($cssPercentile = $math.toInteger($metricsElement.getChild("css").getChild("percentile95").getValue())) 
#set ($cssImagePercentile = $math.toInteger($metricsElement.getChild("cssimages").getChild("percentile95").getValue())) 
#set ($imagePercentile = $math.toInteger($metricsElement.getChild("images").getChild("percentile95").getValue())) 
#set ($pageWeightPercentile = $math.toInteger($metricsElement.getChild("pageweight").getChild("percentile95").getValue())) 
#set ($documentWeightPercentile = $math.toInteger($metricsElement.getChild("documentweight").getChild("percentile95").getValue())) 
#set ($jsSyncInHeadPercentile = $math.toInteger($metricsElement.getChild("jssyncinhead").getChild("percentile95").getValue())) 
#set ($spofPercentile = $math.toInteger($metricsElement.getChild("spof").getChild("percentile95").getValue())) 
#set ($assetsWithoutExpiresPercentile = $math.toInteger($metricsElement.getChild("assetswithoutexpires").getChild("percentile95").getValue())) 
#set ($criticalPathPercentile = $math.toInteger($metricsElement.getChild("criticalpath").getChild("percentile95").getValue())) 
#set ($textContentPercentile = $math.roundTo(1,$metricsElement.getChild("textcontent").getChild("percentile95").getValue()))
#set ($ttfbPercentile = $math.roundTo(3,$metricsElement.getChild("ttfb").getChild("percentile95").getValue()))
#set ($domElementsPercentile = $math.toInteger($metricsElement.getChild("domelements").getChild("percentile95").getValue()))
#set ($backendPercentilePercentage = $math.roundTo(1,$metricsElement.getChild("backend").getChild("percentile95").getValue()))
#set ($frontendPercentilePercentage = $math.roundTo(1,$metricsElement.getChild("frontend").getChild("percentile95").getValue()))
#set ($imageWeightPercentile = $math.roundTo($nrOfDecimals,$metricsElement.getChild("imageweight").getChild("percentile95").getValue())) 
#set ($totalImageWeightPercentile = $math.roundTo($nrOfDecimals,$metricsElement.getChild("totalimageweight").getChild("percentile95").getValue())) 

## Set percentage
#set ($pagesWithSpofPercentage = $math.roundTo($nrOfDecimals, $math.mul($math.div($statsSpofPages.getN(),$siteElement.getChild("pages").getValue()),100)))
#set ($requestWithoutExpirePercentage = $math.roundTo($nrOfDecimals,$math.mul($math.div($totalAssetsWithoutExpiresMedian,$requestMedian),100)))
#set ($imagesPercentage = $math.roundTo($nrOfDecimals,$math.mul($math.div($imageMedian,$requestMedian),100)))
#set ($cssImagesPercentage = $math.roundTo($nrOfDecimals,$math.mul($math.div($cssImageMedian,$requestMedian),100)))
#set ($cssPercentage = $math.roundTo($nrOfDecimals,$math.mul($math.div($cssMedian,$requestMedian),100)))
#set ($jsPercentage = $math.roundTo($nrOfDecimals,$math.mul($math.div($jsMedian,$requestMedian),100)))
#set ($jsInHeadPercentage = $math.roundTo($nrOfDecimals,$math.mul($math.div($totalJsSyncInHeadMedian,$jsMedian),100))) 

#set ($cacheTimeMedian = $header.getSeconds($math.toInteger($metricsElement.getChild("assetcachetimeinseconds").getChild("median").getValue())))
#set ($cacheTimePercentile = $header.getSeconds($math.toInteger($metricsElement.getChild("assetcachetimeinseconds").getChild("percentile95").getValue())))
#set ($modifiedSinceMedian = $header.getSeconds($math.toInteger($metricsElement.getChild("timesincelastmodificationinseconds").getChild("median").getValue())))
#set ($modifiedSincePercentile = $header.getSeconds($math.toInteger($metricsElement.getChild("timesincelastmodificationinseconds").getChild("percentile95").getValue())))

#set($totalSpofPages = $math.toInteger($metricsElement.getChild("spofpages").getChild("values").getValue()))


<div class="row-fluid">
    <div class="span12">

        <h2 class="url">

            $siteElement.getChild("pages").getValue() page#plural($math.toInteger($siteElement.getChild("pages").getValue())) analyzed
                #if ($siteElement.getChild("url").getValue().length()>0)  
                    for <a href="$siteElement.getChild("url").getValue()" target="_blank">$siteElement.getChild("url").getValue()</a>
                #end    
        </h2>
        #if ($testname)
            <h3>$testname</h3>
        #end
        <p>
            Test performed: $siteElement.getChild("date").getValue() with rules $siteElement.getChild("rules").getValue()
        #if ($siteElement.getChild("userAgent").getValue().getValue() != "")
            with user agent: $siteElement.getChild("userAgent").getValue()
            #end
        #if ($siteElement.getChild("viewPort").getValue() != "")
            viewport: $siteElement.getChild("viewPort").getValue()
            #end
        </p>

### $boxes fed from start script
#set ($nrOfBoxes = $boxes.split(",").size())

#set($itemsLastRow = $nrOfBoxes % 3)

## extra new: domains,maximgsize,totaljssize,totalcsssize,browserscaledimg

 #set ($i = 0)  
 #foreach ($box in $boxes.split(","))
    ## If it is time to start a new row
    #if ($i % 3 == 0)
<div class="row-fluid">
    #end

    ## identify last row
    ## and set the right amount of spans
    #if ($nrOfBoxes - $i <= $itemsLastRow)
        #if ($itemsLastRow == 2)
            #set ($span = 6)
        #else
            #set ($span = 12)
        #end
    #else
        #set ($span = 4)
    #end

 <div class="span$span">#getBox($box)</div>
    #set ($i =$math.add($i,1))

 ## End the row
 #if ($i % 3 == 0)
</div>
## or if we are on the last row & don't show three   
 #elseif ($nrOfBoxes - $i == 0)
</div>
#end


 #end



        
	<div class="row-fluid">
            <div class="span12">
            <i>* The value inside of the parentheses are the 95th percentile (95% of the time, the number is below this amount)</i>
            </div>
        </div>
        

        <div class="row-fluid">
            <div class="span12">
                <h3>The rules</h3>
                <p> 
                <b>Sitespeed.io</b> score are based on the <a href="rules.html">rules</a>. 
		<span class="hidden-phone">
		Click <a href="summary.details.html">here</a> to see a detailed version of the summary.
		</span>
                    The rules are simple:
                    <span class="badge badge-success">Green</span>
                    color means you don't need to do anything (of course there could still be things you can do to get better performance).
                    <span class="badge badge-warning">Yellow</span>
                    tells you that you should look into this, and guess what,
                    <span class="badge badge-important">red</span>
                    means that something is really bad. The <span class="badge badge-info">blue</span> color are things for your information, no rules but things that will be good to know.
                </p>
    
            </div>
        </div>

    </div>
</div>
#parse("report/velocity/footer.vm")

<script>

$(function ()
{ $("a[rel=popover]").popover();
});

</script>

</body>
</html>